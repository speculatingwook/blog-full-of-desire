---
title: '[ Spring Sequrity ] ìŠ¤í”„ë§ ì‹œíë¦¬í‹°(Spring security) ì •ë¦¬'
date: '2023-06-28'
tags: ['spring', 'spring_security']
draft: false
summary: ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë‹¤ì‹œ ë³´ê¸°
---

## ê¸°ë³¸ ê°œë…

[ì¸ì¦ê³¼ ì¸ê°€](/blog/java/spring-security/ì¸ì¦ê³¼_ì¸ê°€)

## Spring Securityë€?

Spring SecurityëŠ” Spring ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ(ì¸ì¦ê³¼ ê¶Œí•œ, ì¸ê°€ ë“±)ì„ ë‹´ë‹¹í•˜ëŠ” ìŠ¤í”„ë§ í•˜ìœ„ í”„ë ˆì„ì›Œí¬ì´ë‹¤. Spring SecurityëŠ” 'ì¸ì¦'ê³¼ 'ê¶Œí•œ'ì— ëŒ€í•œ ë¶€ë¶„ì„ Filter íë¦„ì— ë”°ë¼ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.

FilterëŠ” Dispatcher Servletìœ¼ë¡œ ê°€ê¸° ì „ì— ì ìš©ë˜ë¯€ë¡œ ê°€ì¥ ë¨¼ì € URL ìš”ì²­ì„ ë°›ì§€ë§Œ, InterceptorëŠ” Dispatcherì™€ Controllerì‚¬ì´ì— ìœ„ì¹˜í•œë‹¤ëŠ” ì ì—ì„œ ì ìš© ì‹œê¸°ì˜ ì°¨ì´ê°€ ìˆë‹¤.

Spring SecurityëŠ” ë³´ì•ˆê³¼ ê´€ë ¨í•´ì„œ ì²´ê³„ì ìœ¼ë¡œ ë§ì€ ì˜µì…˜ì„ ì œê³µí•´ì£¼ê¸° ë•Œë¬¸ì— ê°œë°œì ì…ì¥ì—ì„œëŠ” ì¼ì¼ì´ ë³´ì•ˆê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

ì´ëŸ¬í•œ Spring Securityì˜ ì•„í‚¤í…ì³ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

## ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ íŠ¹ì§•

1. ì„œë¸”ë¦¿ API í†µí•©
2. Spring Web MVCì™€ì˜ ì„ íƒì  í†µí•©
3. ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ë¥¼ ëª¨ë‘ í¬ê´„ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ì§€ì›
4. ì„¸ì…˜ ê³ ì •, clickjacking, ì‚¬ì´íŠ¸ ê°„ ìš”ì²­ ìœ„ì¡° ë“±ê³¼ ê°™ì€ ê³µê²©ìœ¼ë¡œë¶€í„° ë³´í˜¸

## ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹

<p align="center">
  <img
    alt="image"
    width="600"
    src="https://github.com/speculatingwook/blog-full-of-desire/assets/105579811/a8a0c6aa-700d-48f8-b617-e97167219e45"
  />
</p>

ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” ì„œë¸”ë¦¿ í•„í„°ì²´ì¸ì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•˜ê³  ìš”ì²­ì„ ê±°ì¹˜ê²Œ í•œë‹¤.

<p align="center">
  <img
    width="882"
    alt="image"
    src="https://user-images.githubusercontent.com/105579811/236806863-291c52fc-7810-4b4d-9573-6371cb1b8dc3.png"
  />
</p>

1. ìœ ì € ë¡œê·¸ì¸ ì‹œë„ -->`AuthenticationFilter`ê°€ `Http servlet Request`ì—ì„œ ì‚¬ìš©ìê°€ ë³´ë‚¸ ì •ë³´ë¥¼ interceptí•œë‹¤.
2. ì¸ì¦ìš© ê°ì²´ì¸ `UsernamePasswordAuthenticationToken`ì„ ìƒì„±í•œë‹¤.
3. `UsernamePasswordAuthenticationToken`ì„ `AuthenticationManager interface`ì— ìœ„ì„ì„ í•˜ê²Œ ëœë‹¤. ë§Œì•½ ì„±ê³µí•œë‹¤ë©´ `Authentication` ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.
4. ë°˜í™˜í•œ `Authentication` ê°ì²´ë¥¼ `AuthenticationProvider`ì—ê²Œ ì „ë‹¬í•œë‹¤.
5. `Authentication` ê°ì²´ë¥¼ `UserDetailsService`ì— ì „ë‹¬í•œë‹¤.
6. `UserDetailsService`ëŠ” ë§Œì•½ `Authentication`ì„ ê°€ì§€ë¡œ DBì— ìˆëŠ” Userì„ì„ í•˜ê²Œ ëœë‹¤ë©´, `UserDetails`ì—ì„œ `User`ë¥¼ êº¼ë‚´ì„œ ìœ ì € ì„¸ì…˜ì„ ìƒì„±í•˜ê²Œ ëœë‹¤.
7. ê°€ì ¸ì˜¨ `UserDetails`ë¥¼ Spring Sequrityì˜ ì¸ë©”ëª¨ë¦¬ ì„¸ì…˜ ì €ì¥ì†Œì¸ `SecurityContextHolder`ì— ì €ì¥ì„ í•œë‹¤.
8. ì´í›„, ìœ ì € ì„¸ì…˜IDì™€ í•¨ê»˜ ì‘ë‹µì„ ë³´ë‚´ê²Œ ëœë‹¤.

### `AutenticationManager`ì˜ êµ¬ì¡°

<p align="center">
  <img
    alt="image"
    width="600"
    src="https://github.com/speculatingwook/blog-full-of-desire/assets/105579811/6581065e-c03d-45c3-af42-f527f4ed9c87"
  />
</p>

### Security Context Holder

SecurityContextHolderëŠ” ë³´ì•ˆ ì£¼ì²´ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ì‘ìš©í”„ë˜ê·¸ë¨ì˜ í˜„ì¬ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ê°€ ì €ì¥ëœë‹¤. `SecurityContextHolderëŠ” ê¸°ë³¸ì ìœ¼ë¡œ SecurityContextHolder.MODE_INHERITABLETHREADLOCAL` ë°©ë²•ê³¼ `SecurityContextHolder.MODE_THREADLOCAL` ë°©ë²•ì„ ì œê³µí•œë‹¤.

### Security Context

Authenticationì„ ë³´ê´€í•˜ëŠ” ì—­í• ì„ í•˜ë©°, SecurityContextë¥¼ í†µí•´ Authentication ê°ì²´ë¥¼ êº¼ë‚´ì˜¬ ìˆ˜ ìˆë‹¤.

### Authentication

AuthenticationëŠ” í˜„ì¬ ì ‘ê·¼í•˜ëŠ” ì£¼ì²´ì˜ ì •ë³´ì™€ ê¶Œí•œì„ ë‹´ëŠ” ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. Authentication ê°ì²´ëŠ” Security Contextì— ì €ì¥ë˜ë©°, SecurityContextHolderë¥¼ í†µí•´ SecurityContextì— ì ‘ê·¼í•˜ê³ , SecurityContextë¥¼ í†µí•´ Authenticationì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```java
public interface Authentication extends Principal, Serializable {
    // í˜„ì¬ ì‚¬ìš©ìì˜ ê¶Œí•œ ëª©ë¡ì„ ê°€ì ¸ì˜´
    Collection<? extends GrantedAuthority> getAuthorities();

    // credentials(ì£¼ë¡œ ë¹„ë°€ë²ˆí˜¸)ì„ ê°€ì ¸ì˜´
    Object getCredentials();

    Object getDetails();

    // Principal ê°ì²´ë¥¼ ê°€ì ¸ì˜´.
    Object getPrincipal();

    // ì¸ì¦ ì—¬ë¶€ë¥¼ ê°€ì ¸ì˜´
    boolean isAuthenticated();

    // ì¸ì¦ ì—¬ë¶€ë¥¼ ì„¤ì •í•¨
    void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException;
}
```

### UserNameAuthenticationToken

UsernamePasswordAuthenticationTokenì€ Authenticationì„ implementsí•œ AbstractAuthenticationTokenì˜ í•˜ìœ„ í´ë˜ìŠ¤ë¡œ, Userì˜ IDê°€ Principal ì—­í• ì„ í•˜ê³ , Passwordê°€ Credentialì˜ ì—­í• ì„ í•œë‹¤. UsernamePasswordAuthenticationTokenì˜ ì²« ë²ˆì§¸ ìƒì„±ìëŠ” ì¸ì¦ ì „ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ë‘ë²ˆì§¸ ìƒì„±ìëŠ” ì¸ì¦ì´ ì™„ë£Œëœ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

```java
public class UsernamePasswordAuthenticationToken extends AbstractAuthenticationToken {
    // ì£¼ë¡œ ì‚¬ìš©ìì˜ IDì— í•´ë‹¹í•¨
    private final Object principal;
    // ì£¼ë¡œ ì‚¬ìš©ìì˜ PWì— í•´ë‹¹í•¨
    private Object credentials;

    // ì¸ì¦ ì™„ë£Œ ì „ì˜ ê°ì²´ ìƒì„±
    public UsernamePasswordAuthenticationToken(Object principal, Object credentials) {
		super(null);
		this.principal = principal;
		this.credentials = credentials;
		setAuthenticated(false);
	}

    // ì¸ì¦ ì™„ë£Œ í›„ì˜ ê°ì²´ ìƒì„±
    public UsernamePasswordAuthenticationToken(Object principal, Object credentials,
			Collection<? extends GrantedAuthority> authorities) {
		super(authorities);
		this.principal = principal;
		this.credentials = credentials;
		super.setAuthenticated(true); // must use super, as we override
	}
}


public abstract class AbstractAuthenticationToken implements Authentication, CredentialsContainer {
}
```

### AuthenticationProvider

AuthenticationProviderì—ì„œëŠ” ì‹¤ì œ ì¸ì¦ì— ëŒ€í•œ ë¶€ë¶„ì„ ì²˜ë¦¬í•˜ëŠ”ë°, ì¸ì¦ ì „ì˜ Authenticationê°ì²´ë¥¼ ë°›ì•„ì„œ ì¸ì¦ì´ ì™„ë£Œëœ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì•„ë˜ì™€ ê°™ì€ AuthenticationProvider ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì„œ Customí•œ AuthenticationProviderì„ ì‘ì„±í•´ì„œ AuthenticationManagerì— ë“±ë¡í•˜ë©´ ëœë‹¤.

```java
public interface AuthenticationProvider {

	// ì¸ì¦ ì „ì˜ Authenticaion ê°ì²´ë¥¼ ë°›ì•„ì„œ ì¸ì¦ëœ Authentication ê°ì²´ë¥¼ ë°˜í™˜
    Authentication authenticate(Authentication var1) throws AuthenticationException;

    boolean supports(Class<?> var1);

}
```

### Authenticatoin Manager

ì¸ì¦ì— ëŒ€í•œ ë¶€ë¶„ì€ SpringSecurityì˜ AuthenticatonManagerë¥¼ í†µí•´ì„œ ì²˜ë¦¬í•˜ê²Œ ë˜ëŠ”ë°, ì‹¤ì§ˆì ìœ¼ë¡œëŠ” AuthenticationManagerì— ë“±ë¡ëœ AuthenticationProviderì— ì˜í•´ ì²˜ë¦¬ëœë‹¤. ì¸ì¦ì´ ì„±ê³µí•˜ë©´ 2ë²ˆì§¸ ìƒì„±ìë¥¼ ì´ìš©í•´ ì¸ì¦ì´ ì„±ê³µí•œ(isAuthenticated=true) ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ Security Contextì— ì €ì¥í•œë‹¤. ê·¸ë¦¬ê³  ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ì„¸ì…˜ì— ë³´ê´€í•˜ë©°, ì¸ì¦ì´ ì‹¤íŒ¨í•œ ê²½ìš°ì—ëŠ” AuthenticationExceptionë¥¼ ë°œìƒì‹œí‚¨ë‹¤.

```java
public interface AuthenticationManager {
	Authentication authenticate(Authentication authentication)
		throws AuthenticationException;
}
```

AuthenticationManagerë¥¼ implementsí•œ ProviderManagerëŠ” ì‹¤ì œ ì¸ì¦ ê³¼ì •ì— ëŒ€í•œ ë¡œì§ì„ ê°€ì§€ê³  ìˆëŠ” AuthenticaionProviderë¥¼ Listë¡œ ê°€ì§€ê³  ìˆìœ¼ë©°, ProividerManagerëŠ” forë¬¸ì„ í†µí•´ ëª¨ë“  providerë¥¼ ì¡°íšŒí•˜ë©´ì„œ authenticate ì²˜ë¦¬ë¥¼ í•œë‹¤.

```java
public class ProviderManager implements AuthenticationManager, MessageSourceAware,
InitializingBean {
    public List<AuthenticationProvider> getProviders() {
		return providers;
	}
    public Authentication authenticate(Authentication authentication)
			throws AuthenticationException {
		Class<? extends Authentication> toTest = authentication.getClass();
		AuthenticationException lastException = null;
		Authentication result = null;
		boolean debug = logger.isDebugEnabled();
        //forë¬¸ìœ¼ë¡œ ëª¨ë“  providerë¥¼ ìˆœíšŒí•˜ì—¬ ì²˜ë¦¬í•˜ê³  resultê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤.
		for (AuthenticationProvider provider : getProviders()) {
            ....
			try {
				result = provider.authenticate(authentication);

				if (result != null) {
					copyDetails(authentication, result);
					break;
				}
			}
			catch (AccountStatusException e) {
				prepareException(e, authentication);
				// SEC-546: Avoid polling additional providers if auth failure is due to
				// invalid account status
				throw e;
			}
            ....
		}
		throw lastException;
	}
}
```

ìœ„ì—ì„œ ì„¤ëª…í•œ ProviderManagerì— ìš°ë¦¬ê°€ ì§ì ‘ êµ¬í˜„í•œ CustomAuthenticationProviderë¥¼ ë“±ë¡í•˜ëŠ” ë°©ë²•ì€ WebSecurityConfigurerAdapterë¥¼ ìƒì†í•´ ë§Œë“  SecurityConfigì—ì„œ í•  ìˆ˜ ìˆë‹¤. WebSecurityConfigurerAdapterì˜ ìƒìœ„ í´ë˜ìŠ¤ì—ì„œëŠ” AuthenticationManagerë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì§ì ‘ ë§Œë“  CustomAuthenticationProviderë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Bean
    public AuthenticationManager getAuthenticationManager() throws Exception {
        return super.authenticationManagerBean();
    }

    @Bean
    public CustomAuthenticationProvider customAuthenticationProvider() throws Exception {
        return new CustomAuthenticationProvider();
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.authenticationProvider(customAuthenticationProvider());
    }
}
```

### UserDetails

ì¸ì¦ì— ì„±ê³µí•˜ì—¬ ìƒì„±ëœ UserDetails ê°ì²´ëŠ” Authenticationê°ì²´ë¥¼ êµ¬í˜„í•œ UsernamePasswordAuthenticationTokenì„ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤. UserDetails ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆë‹¤. UserDetails ì¸í„°í˜ì´ìŠ¤ì˜ ê²½ìš° ì§ì ‘ ê°œë°œí•œ UserVO ëª¨ë¸ì— UserDetailsë¥¼ implementsí•˜ì—¬ ì´ë¥¼ ì²˜ë¦¬í•˜ê±°ë‚˜ UserDetailsVOì— UserDetailsë¥¼ implementsí•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```java
public interface UserDetails extends Serializable {

    Collection<? extends GrantedAuthority> getAuthorities();

    String getPassword();

    String getUsername();

    boolean isAccountNonExpired();

    boolean isAccountNonLocked();

    boolean isCredentialsNonExpired();

    boolean isEnabled();

}
```

### UserDetailsService

UserDetailsService ì¸í„°í˜ì´ìŠ¤ëŠ” UserDetails ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë‹¨ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ ê°€ì§€ê³  ìˆëŠ”ë°, ì¼ë°˜ì ìœ¼ë¡œ ì´ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ë‚´ë¶€ì— UserRepositoryë¥¼ ì£¼ì…ë°›ì•„ DBì™€ ì—°ê²°í•˜ì—¬ ì²˜ë¦¬í•œë‹¤. UserDetails ì¸í„°í˜ì´ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```java
public interface UserDetailsService {

    UserDetails loadUserByUsername(String var1) throws UsernameNotFoundException;

}
```

### Password Encoding

AuthenticationManagerBuilder.userDetailsService().passwordEncoder() ë¥¼ í†µí•´ íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™”ì— ì‚¬ìš©ë  PasswordEncoder êµ¬í˜„ì²´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```java
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
	// TODO Auto-generated method stub
	auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
}

@Bean
public PasswordEncoder passwordEncoder(){
	return new BCryptPasswordEncoder();
}
```

### Granted Authority

GrantAuthorityëŠ” í˜„ì¬ ì‚¬ìš©ì(principal)ê°€ ê°€ì§€ê³  ìˆëŠ” ê¶Œí•œì„ ì˜ë¯¸í•œë‹¤. ROLE*ADMINë‚˜ ROLE_USERì™€ ê°™ì´ ROLE*\*ì˜ í˜•íƒœë¡œ ì‚¬ìš©í•˜ë©°, ë³´í†µ "roles" ì´ë¼ê³  í•œë‹¤. GrantedAuthority ê°ì²´ëŠ” UserDetailsServiceì— ì˜í•´ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆê³ , íŠ¹ì • ìì›ì— ëŒ€í•œ ê¶Œí•œì´ ìˆëŠ”ì§€ë¥¼ ê²€ì‚¬í•˜ì—¬ ì ‘ê·¼ í—ˆìš© ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤.

## ì‹œíë¦¬í‹°ì˜ ì£¼ìš” í•„í„°

### `SecurityContextPersistenseFilter`

- SecurityContextRepositoryë¥¼ í†µí•´ SecurityContextë¥¼ Load/Save ì²˜ë¦¬

### `LogoutFilter`

- ë¡œê·¸ì•„ì›ƒ URL(ê¸°ë³¸ê°’: /logout)ë¡œì˜ ìš”ì²­ì„ ê°ì‹œí•˜ì—¬ í•´ë‹¹ ì‚¬ìš©ìë¥¼ ë¡œê·¸ì•„ì›ƒ ì‹œí‚´

### `UsernamePasswordAuthenticationFilter`

- ID/PW ê¸°ë°˜ Form ì¸ì¦ ìš”ì²­ URL(ê¸°ë³¸ê°’: /login)ì„ ê°ì‹œí•˜ì—¬ ì‚¬ìš©ìë¥¼ ì¸ì¦í•¨

### `ExceptionTransiationFilter`

- ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘ì— ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ìœ„ì„í•˜ê±°ë‚˜ ì „ë‹¬

### `FilterSecurityInterceptor`

- ì ‘ê·¼ ê¶Œí•œ í™•ì¸ì„ ìœ„í•´ ìš”ì²­ì„ AccessDecisionManagerë¡œ ìœ„ì„. ì´ í•„í„°ê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì ì—ëŠ” ì‚¬ìš©ìê°€ ì¸ì¦ëë‹¤ê³  íŒë‹¨

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .cors() // CORS ì„¤ì • í™œì„±í™”
    .and()
        .sessionManagement() // ì„¸ì…˜ ê´€ë¦¬ ì„¤ì •
        .sessionCreationPolicy(SessionCreationPolicy.STATELESS) // ì„¸ì…˜ ìƒì„± ì •ì±…ì„ Statelessë¡œ ì„¤ì •
    .and()
        .csrf().disable() // CSRF ë°©ì§€ ê¸°ëŠ¥ ë¹„í™œì„±í™”
        .formLogin().disable() // í¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ ë¹„í™œì„±í™”
        .httpBasic().disable() // ê¸°ë³¸ HTTP ì¸ì¦ ê¸°ëŠ¥ ë¹„í™œì„±í™”
        .exceptionHandling() // ì˜ˆì™¸ ì²˜ë¦¬ ì„¤ì •
        .authenticationEntryPoint(new RestAuthenticationEntryPoint()) // ì‚¬ìš©ì ì •ì˜ ì¸ì¦ ì§„ì…ì  ì„¤ì •
        .accessDeniedHandler(tokenAccessDeniedHandler) // ì‚¬ìš©ì ì •ì˜ ì ‘ê·¼ ê±°ë¶€ í•¸ë“¤ëŸ¬ ì„¤ì •
    .and()
        .authorizeRequests() // ìš”ì²­ ì¸ì¦ ì„¤ì •
        .requestMatchers(CorsUtils::isPreFlightRequest).permitAll() // CORS ì „ì²˜ë¦¬ ìš”ì²­ì— ëŒ€í•´ ì¸ì¦ì„ í—ˆìš©
        .antMatchers("/api/**").hasAnyAuthority(RoleType.USER.getCode()) // "/api/**" íŒ¨í„´ì˜ URLì— USER ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ì ‘ê·¼ í—ˆìš©
        .antMatchers("/api/**/admin/**").hasAnyAuthority(RoleType.ADMIN.getCode()) // "/api/**/admin/**" íŒ¨í„´ì˜ URLì— ADMIN ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ì ‘ê·¼ í—ˆìš©
        .anyRequest().authenticated() // ë‚˜ë¨¸ì§€ ìš”ì²­ì€ ëª¨ë‘ ì¸ì¦ ë°›ì€ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
    .and()
        .oauth2Login() // OAuth2 ë¡œê·¸ì¸ ì„¤ì •
        .authorizationEndpoint()
        .baseUri("/oauth2/authorization") // ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸ ê¸°ë³¸ URI ì„¤ì •
        .authorizationRequestRepository(oAuth2AuthorizationRequestBasedOnCookieRepository()) // ì‚¬ìš©ì ì •ì˜ ì¸ì¦ ìš”ì²­ ì €ì¥ì†Œ ì„¤ì •
    .and()
        .redirectionEndpoint() // ë¦¬ë‹¤ì´ë ‰ì…˜ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        .baseUri("/*/oauth2/code/*") // ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ë°œìƒí•˜ëŠ” ê¸°ë³¸ URI ì„¤ì •
    .and()
        .userInfoEndpoint() // ì‚¬ìš©ì ì •ë³´ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
        .userService(oAuth2UserService) // ì‚¬ìš©ì ì •ë³´ ì„œë¹„ìŠ¤ ì„¤ì •
    .and()
        .successHandler(oAuth2AuthenticationSuccessHandler()) // OAuth2 ì¸ì¦ ì„±ê³µ í•¸ë“¤ëŸ¬ ì„¤ì •
        .failureHandler(oAuth2AuthenticationFailureHandler()); // OAuth2 ì¸ì¦ ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ ì„¤ì •

    http.addFilterBefore(tokenAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class); // ì‚¬ìš©ì ì •ì˜ í•„í„°ë¥¼ í•„í„° ì²´ì¸ì— ì¶”ê°€
}
```

**ì¶œì²˜**

[[10ë¶„ í…Œì½”í†¡] ğŸ»ì‘ì€ê³°ì˜ Spring Security](https://youtu.be/aEk-7RjBKwQ)

[Spring Securityë€?](https://mangkyu.tistory.com/76)

[Spring Security ì²˜ë¦¬ ê³¼ì • ë° êµ¬í˜„ ì˜ˆì œ](https://mangkyu.tistory.com/77)
